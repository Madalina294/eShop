<div class="products-container" (click)="closeMenu()">
  <mat-card class="products-header-card">
    <mat-card-header>
      <div mat-card-avatar>
        <mat-icon>category</mat-icon>
      </div>
      <mat-card-title>{{ "viewProducts.title" | translate }}</mat-card-title>
      <mat-card-subtitle>{{
        "viewProducts.subtitle" | translate
      }}</mat-card-subtitle>
    </mat-card-header>
    <button
      mat-button
      routerLink="/admin/add-product"
      style="
        background-color: #6b46c1;
        color: white;
        align-content: flex-end;
        border-radius: 10px;
      "
    >
      <mat-icon>add</mat-icon>
      <span>{{ "viewProducts.addProduct" | translate }}</span>
    </button>
  </mat-card>

  <!-- Loading Spinner -->
  <div *ngIf="loading()" class="loading-container">
    <mat-progress-spinner
      mode="indeterminate"
      diameter="50"
    ></mat-progress-spinner>
    <p>{{ "viewProducts.loadingProducts" | translate }}</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error() && !loading()" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error() }}</p>
    <button mat-raised-button color="primary" (click)="loadProducts()">
      <mat-icon>refresh</mat-icon>
      {{ "viewProducts.loadAgain" | translate }}
    </button>
  </div>

  <!-- Products List -->
  <div *ngIf="!loading() && !error()" class="user-list">
    <!-- Controls -->
    <div class="controls-section">
      <div class="sort-controls">
        <mat-form-field appearance="outline">
          <mat-label>{{ "viewProducts.sortBy" | translate }}</mat-label>
          <mat-select
            [value]="sortBy()"
            (selectionChange)="onSortChange($event.value)"
          >
            <mat-option value="id">{{
              "viewProducts.sortOptions.id" | translate
            }}</mat-option>
            <mat-option value="name">{{
              "viewProducts.sortOptions.name" | translate
            }}</mat-option>
            <mat-option value="price">{{
              "viewProducts.sortOptions.price" | translate
            }}</mat-option>
            <mat-option value="color">{{
              "viewProducts.sortOptions.color" | translate
            }}</mat-option>
            <mat-option value="material">{{
              "viewProducts.sortOptions.material" | translate
            }}</mat-option>
            <mat-option value="weight">{{
              "viewProducts.sortOptions.weight" | translate
            }}</mat-option>
            <mat-option value="dimensions">{{
              "viewProducts.sortOptions.dimension" | translate
            }}</mat-option>
            <mat-option value="category">{{
              "viewProducts.sortOptions.category" | translate
            }}</mat-option>
            <mat-option value="quantity">{{
              "viewProducts.sortOptions.quantity" | translate
            }}</mat-option>
          </mat-select>
        </mat-form-field>

        <button
          mat-icon-button
          (click)="onSortDirectionChange()"
          [title]="
            sortDir() === 'asc'
              ? ('viewProducts.sortAscending' | translate)
              : ('viewProducts.sortDescending' | translate)
          "
        >
          <mat-icon>{{
            sortDir() === "asc" ? "arrow_upward" : "arrow_downward"
          }}</mat-icon>
        </button>
      </div>

      <div class="pagination-info">
        {{ "viewProducts.showing" | translate }}
        {{ currentPage() * pageSize() + 1 }} -
        {{ Math.min((currentPage() + 1) * pageSize(), totalElements()) }}
        {{ "viewProducts.of" | translate }} {{ totalElements() }}
        {{ "viewProducts.products" | translate }}
      </div>
    </div>

    <div *ngIf="products().length === 0" class="no-users">
      <mat-icon>find_replace</mat-icon>
      <p>{{ "viewProducts.noProductsFound" | translate }}</p>
    </div>

    <div class="products-table">
      <!-- Table Header -->
      <div class="table-header">
        <div class="table-cell">ID</div>
        <div class="table-cell">{{ "viewProducts.name" | translate }}</div>
        <div class="table-cell">{{ "viewProducts.price" | translate }}</div>
        <div class="table-cell">{{ "viewProducts.category" | translate }}</div>
        <div class="table-cell">{{ "viewProducts.color" | translate }}</div>
        <div class="table-cell">
          {{ "viewProducts.dimensions" | translate }}
        </div>
        <div class="table-cell">{{ "viewProducts.material" | translate }}</div>
        <div class="table-cell">{{ "viewProducts.quantity" | translate }}</div>
        <div class="table-cell actions-header">
          {{ "viewProducts.actions" | translate }}
        </div>
      </div>

      <!-- Table Rows -->
      <div *ngFor="let product of products()" class="product-row">
        <div class="table-cell">{{ product.id }}</div>
        <div class="table-cell">{{ product.name }}</div>
        <div class="table-cell">{{ product.price }} $</div>
        <div class="table-cell">{{ getCategoryName(product.categoryId) }}</div>
        <div class="table-cell">{{ product.color }}</div>
        <div class="table-cell">{{ product.dimensions }}</div>
        <div class="table-cell">{{ product.material }}</div>
        <div class="table-cell">{{ product.quantity }}</div>
        <div class="table-cell actions-cell">
          <button
            mat-icon-button
            class="menu-button"
            (click)="handleMenuClick(product.id, $event)"
            [attr.aria-label]="'Open menu for product ' + product.name"
          >
            <mat-icon>more_vert</mat-icon>
          </button>

          <!-- Popup Menu -->
          <div
            *ngIf="activeMenuId() === product.id"
            class="menu-popup"
            (click)="$event.stopPropagation()"
          >
            <button
              mat-menu-item
              class="menu-item edit-item"
              (click)="onEditProduct(product)"
            >
              <mat-icon>edit</mat-icon>
              <span>{{ "viewProducts.editProduct" | translate }}</span>
            </button>
            <button
              mat-menu-item
              class="menu-item delete-item"
              (click)="onDeleteProduct(product)"
            >
              <mat-icon>delete</mat-icon>
              <span>{{ "viewProducts.deleteProduct" | translate }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <mat-paginator
      *ngIf="totalElements() > 0"
      [length]="totalElements()"
      [pageSize]="pageSize()"
      [pageIndex]="currentPage()"
      [pageSizeOptions]="pageSizeOptions"
      [showFirstLastButtons]="true"
      (page)="onPageChange($event)"
      class="pagination-controls"
    >
    </mat-paginator>
  </div>
</div>
