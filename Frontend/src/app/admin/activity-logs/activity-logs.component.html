<div class="activity-logs-container">
  <app-breadcrumb></app-breadcrumb>

  <div class="header-section">
    <h1>{{ "activityLogs.title" | translate }}</h1>
  </div>

  <!-- Filters Card -->
  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>filter_list</mat-icon>
        {{ "activityLogs.filters.title" | translate }}
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="filters-grid">
        <!-- User Filter -->
        <mat-form-field appearance="outline">
          <mat-label>{{ "activityLogs.filters.user" | translate }}</mat-label>
          <mat-select [(ngModel)]="selectedUserIdValue" (selectionChange)="onFilterChange()">
            <mat-option [value]="null">{{ "activityLogs.filters.allUsers" | translate }}</mat-option>
            <mat-option *ngFor="let user of users()" [value]="user.userId">
              {{ user.firstName }} {{ user.lastName }} ({{ user.email }})
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Action Type Filter -->
        <mat-form-field appearance="outline">
          <mat-label>{{ "activityLogs.filters.actionType" | translate }}</mat-label>
          <mat-select [(ngModel)]="selectedActionTypeValue" (selectionChange)="onFilterChange()">
            <mat-option value="">{{ "activityLogs.filters.allActions" | translate }}</mat-option>
            <mat-option *ngFor="let actionType of actionTypes()" [value]="actionType">
              {{ actionType }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Status Filter -->
        <mat-form-field appearance="outline">
          <mat-label>{{ "activityLogs.filters.status" | translate }}</mat-label>
          <mat-select [(ngModel)]="selectedStatusValue" (selectionChange)="onFilterChange()">
            <mat-option value="">{{ "activityLogs.filters.allStatuses" | translate }}</mat-option>
            <mat-option *ngFor="let status of statuses()" [value]="status">
              {{ status }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Start Date -->
        <mat-form-field appearance="outline">
          <mat-label>{{ "activityLogs.filters.startDate" | translate }}</mat-label>
          <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDateValue" (dateChange)="onFilterChange()">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <!-- End Date -->
        <mat-form-field appearance="outline">
          <mat-label>{{ "activityLogs.filters.endDate" | translate }}</mat-label>
          <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDateValue" (dateChange)="onFilterChange()">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>

        <!-- Clear Filters Button -->
        <div class="clear-filters">
          <button mat-raised-button color="warn" (click)="clearFilters()">
            <mat-icon>clear</mat-icon>
            {{ "activityLogs.filters.clear" | translate }}
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Activity Logs Table -->
  <mat-card class="logs-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>history</mat-icon>
        {{ "activityLogs.logs.title" | translate }}
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="loading()" class="loading-spinner">
        <mat-spinner diameter="50"></mat-spinner>
      </div>

      <div *ngIf="!loading() && activityLogs().length > 0">
        <table mat-table [dataSource]="activityLogs()" class="activity-logs-table">
          <!-- Timestamp Column -->
          <ng-container matColumnDef="timestamp">
            <th mat-header-cell *matHeaderCellDef>{{ "activityLogs.logs.timestamp" | translate }}</th>
            <td mat-cell *matCellDef="let log">{{ formatDate(log.createdAt) }}</td>
          </ng-container>

          <!-- User Column -->
          <ng-container matColumnDef="user">
            <th mat-header-cell *matHeaderCellDef>{{ "activityLogs.logs.user" | translate }}</th>
            <td mat-cell *matCellDef="let log">
              <span *ngIf="log.userName">{{ log.userName }}</span>
              <span *ngIf="!log.userName" class="no-user">{{ "activityLogs.logs.guest" | translate }}</span>
            </td>
          </ng-container>

          <!-- Action Type Column -->
          <ng-container matColumnDef="actionType">
            <th mat-header-cell *matHeaderCellDef>{{ "activityLogs.logs.actionType" | translate }}</th>
            <td mat-cell *matCellDef="let log">{{ log.actionType }}</td>
          </ng-container>

          <!-- Action Description Column -->
          <ng-container matColumnDef="actionDescription">
            <th mat-header-cell *matHeaderCellDef>{{ "activityLogs.logs.description" | translate }}</th>
            <td mat-cell *matCellDef="let log" class="description-cell">
              {{ log.actionDescription || '-' }}
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>{{ "activityLogs.logs.status" | translate }}</th>
            <td mat-cell *matCellDef="let log">
              <span [class]="getStatusClass(log.status)">{{ log.status }}</span>
            </td>
          </ng-container>

          <!-- IP Address Column -->
          <ng-container matColumnDef="ipAddress">
            <th mat-header-cell *matHeaderCellDef>{{ "activityLogs.logs.ipAddress" | translate }}</th>
            <td mat-cell *matCellDef="let log">{{ log.ipAddress || '-' }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>

        <!-- Pagination -->
        <mat-paginator
          [length]="totalElements()"
          [pageSize]="pageSize()"
          [pageIndex]="currentPage()"
          [pageSizeOptions]="[10, 20, 50, 100]"
          [showFirstLastButtons]="true"
          (page)="onPageChange($event)"
          class="pagination-controls"
        ></mat-paginator>
      </div>

      <div *ngIf="!loading() && activityLogs().length === 0" class="no-data">
        <mat-icon>inbox</mat-icon>
        <p>{{ "activityLogs.logs.noLogs" | translate }}</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>

